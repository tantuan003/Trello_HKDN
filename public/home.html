<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>Trang chá»§</title>
  <link rel="stylesheet" href="./css/sidebar_header.css?v=1" />
  <link rel="stylesheet" href="./css/home.css" />

</head>

<body>
  <!-- Header + Sidebar sáº½ Ä‘Æ°á»£c inject vÃ o Ä‘Ã¢y -->
  <div id="app-shell"></div>

  <!-- MAIN CONTENT cá»§a trang Boards -->
  <main class="content content-boards">
    <!-- Recently viewed -->
    <section class="section-block">
      <div class="section-head">
        <div class="section-title">
          <h3>Recently viewed</h3>
        </div>
      </div>

      <!-- JS sáº½ render cÃ¡c board-card vÃ o Ä‘Ã¢y -->
      <div id="recent-boards" class="card-grid">
        <!-- Loading state -->
        <p id="recent-loading">Äang táº£i danh sÃ¡ch board...</p>
      </div>
    </section>


    <!-- Your workspaces -->
    <section class="section-block">
      <div class="section-head">
        <h3 class="heading">YOUR WORKSPACES</h3>
        <div class="actions-inline">
          <a class="chip" href="#"><span class="ic">ğŸ—‚ï¸</span>Boards</a>
          <a class="chip" href="#"><span class="ic">ğŸ‘¤</span>Members</a>
          <a class="chip" href="#"><span class="ic">âš™ï¸</span>Settings</a>
        </div>
      </div>

      <div class="workspace-row">
        <div class="ws-title">
          <span class="ws-badge">T</span>
          <span class="ws-name">Trello Workspace</span>
        </div>
      </div>

      <div class="card-grid mt-2">
        <a class="board-card" href="#">
          <div class="board-cover gradient-1"></div>
          <div class="board-footer"><span class="board-title">My Trello board</span></div>
        </a>

        <button class="board-card create-card" type="button">
          <div class="create-body">Create new board</div>
        </button>
      </div>

      <div class="mt-3">
        <a class="btn-outline" href="#">View all closed boards</a>
      </div>
    </section>
  </main>
</body>
<script>
  // ChÃ¨n file components/sidebar_header.html vÃ o #app-shell
  async function inject(file, targetSelector) {
    try {
      const res = await fetch(file, { cache: 'no-store' });
      if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
      const html = await res.text();
      document.querySelector(targetSelector).innerHTML = html;
    } catch (err) {
      console.error('Load component failed:', file, err);
    }
  }

  // ÄÃ¡nh dáº¥u menu "Boards" sÃ¡ng trong sidebar
  function activateBoardsMenu() {
    const links = document.querySelectorAll('.nav .nav-item');
    links.forEach(a => a.classList.remove('is-active'));
    const boardsLink = [...links].find(a => /boards/i.test(a.textContent.trim()));
    if (boardsLink) boardsLink.classList.add('is-active');
  }

  // ğŸ§© Táº¡o 1 board-card tá»« object board tráº£ vá» tá»« API
  function createBoardCard(board) {
    const a = document.createElement('a');
    a.className = 'board-card';
    // tuá»³ báº¡n route UI, vÃ­ dá»¥: /board.html?id=xxx hoáº·c /boards/xxx
    a.href = `/boards/${board._id}`;

    const cover = document.createElement('div');
    cover.className = `board-cover ${board.background || 'gradient-1'}`;

    const footer = document.createElement('div');
    footer.className = 'board-footer';

    const title = document.createElement('span');
    title.className = 'board-title';
    title.textContent = board.name;

    footer.appendChild(title);
    a.appendChild(cover);
    a.appendChild(footer);

    return a;
  }

  // ğŸ§© Gá»i API láº¥y list board cá»§a user hiá»‡n táº¡i (Ä‘Ã£ sort theo lastViewedAt)
 async function loadRecentBoards() {
  const container = document.getElementById('recent-boards');
  const loadingEl = document.getElementById('recent-loading');

  try {
    const res = await fetch('http://localhost:8127/v1/board/recent', {
      credentials: 'include', // gá»­i token/cookie
      headers: {
        'Content-Type': 'application/json'
      }
    });

    const json = await res.json(); // Ä‘á»c JSON object

    if (!res.ok || json.success === false) {
      console.error("API error:", json);
      if (loadingEl) loadingEl.textContent = json.message || "KhÃ´ng thá»ƒ táº£i danh sÃ¡ch board.";
      return;
    }

    const boards = json.data || [];  // láº¥y data tá»« JSON

    if (loadingEl) loadingEl.remove();

    if (boards.length === 0) {
      const empty = document.createElement('p');
      empty.textContent = 'Báº¡n chÆ°a cÃ³ board nÃ o.';
      container.appendChild(empty);
      return;
    }

    // Render theo thá»© tá»± Ä‘Ã£ sort lastViewedAt
    boards.forEach(board => {
      const card = createBoardCard(board);
      container.appendChild(card);
    });

  } catch (err) {
    console.error("Lá»—i fetch:", err);
    if (loadingEl) loadingEl.textContent = 'KhÃ´ng thá»ƒ táº£i danh sÃ¡ch board.';
  }
}

  document.addEventListener('DOMContentLoaded', async () => {
    await inject('./components/sidebar_header.html', '#app-shell');
    import("./js/Sidebar_Header.js").then(module => {
      module.initSidebarHeader();  
    });
    activateBoardsMenu();

    // ğŸ‘‰ Load danh sÃ¡ch board theo â€œÄ‘Ã£ xem gáº§n Ä‘Ã¢yâ€
    loadRecentBoards();
  });
</script>
<script type="module" src="./js/Sidebar_Header.js"></script>


</html>